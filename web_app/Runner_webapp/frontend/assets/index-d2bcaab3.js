import{r as l,q,j as e,a9 as H}from"./index-bf8a941f.js";import{C as R}from"./Card-24bc2910.js";import{B as W}from"./Tag-338a2893.js";import{I as T}from"./ImageWithFallBack-a6a1ee24.js";import"./Alert-1d842e79.js";import"./Badge-b1f0ab32.js";import{B as h}from"./Button-0f33c8fd.js";import"./index-6975cd84.js";import"./index-9cb1fb6e.js";import{D as b}from"./Skeleton-67f3ebea.js";import"./Switcher-2f2e5a73.js";import{D as M}from"./index-8128ce47.js";import"./FormContainer-7c6e47ec.js";import"./Input-9402e44f.js";import"./index-754123b4.js";import{t as O,N as E}from"./toast-c77230e6.js";import"./index-6728dd01.js";import"./Select-d53c46ac.js";import"./index-de79736a.js";import"./index-18669cea.js";import"./index-0a71f11b.js";import"./Upload-cf8abc1c.js";import{a as J,c as Q}from"./DeviceApi-c140c236.js";import{u as V}from"./index-67a7497f.js";import{k as X,l as Z,a as ee}from"./ServiceAPI-25e2710b.js";import{S as se}from"./Statistic-5f1ff676.js";import"./RichTextEditor-3ec4d100.js";import"./Views-4bab5f03.js";import"./SegmentItemOption-48394355.js";import"./SvgIcon-51ef36c9.js";import"./usePopper-113fdeb0.js";import"./index-a2b882c4.js";import"./index-2e58d6d9.js";import"./motion-23928477.js";import"./StatusIcon-0225b6e9.js";import"./index.esm-4fe97196.js";import"./CloseButton-d50c43fd.js";import"./context-3c7bf7d8.js";import"./useControllableState-1a7323ea.js";import"./cloneDeep-93156ba4.js";import"./_MapCache-72043566.js";import"./get-9e555ae1.js";import"./index-13a8329a.js";import"./index-346a9733.js";import"./useThemeClass-81aec1c2.js";const te=({className:f,name:j,installationPrice:a,type:u,description:r,serviceImage:c,serviceData:s})=>{const[S,g]=l.useState(!1),[L,d]=l.useState(!1),[A,x]=l.useState(!1),[F,z]=l.useState(!1),[m,N]=l.useState(""),[n,v]=l.useState({name:"",mac:"",encryptedId:""}),y=l.useRef(),{_id:o}=V(t=>t.auth.user),[w,G]=l.useState([]),[I,P]=l.useState([]),$=q();l.useEffect(()=>{async function t(){const i=await J(o||"");G(i==null?void 0:i.data.data);const p=await Q();P(p==null?void 0:p.data.data)}t()},[]);const K=e.jsxs("section",{className:"flex flex-col w-full gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(W,{size:"32"}),e.jsxs("span",{children:[e.jsx("h6",{className:"text-sm",children:"Installation Price"}),e.jsxs("span",{className:"text-xs",children:["$",a]})]})]}),e.jsx(h,{variant:"solid",size:"sm",onClick:()=>g(!0),children:"Install Service"})]}),D=e.jsx("div",{className:"flex card-header-svg items-center justify-center rounded-tl-lg rounded-tr-lg overflow-hidden",children:e.jsx(T,{src:c&&c||"/img/others/img-1.jpg",alt:"card header"})});function U(t){N(t)}function B({data:t}){return e.jsx("div",{onClick:()=>{v({name:t.deviceName,mac:t.mac,encryptedId:t.deviceEncryptedId}),d(!1)},className:"w-full text-center cursor-pointer py-1 hover:bg-[#374151] rounded-lg",children:e.jsxs("p",{children:[t.deviceName," ( ",t.mac," )"]})})}l.useEffect(()=>{S==!1&&(d(!1),N(""),v({name:"",mac:"",encryptedId:""}))},[S]);async function Y(){var t;try{z(!0);let i=!1;const p=await X((o==null?void 0:o.toString())||"");if((t=p==null?void 0:p.data)==null||t.data.map((k,ie)=>{var _;k.serviceId==(s==null?void 0:s._id)&&k.insertedBy.toString()==(o==null?void 0:o.toString())&&((_=k.deviceMap)==null?void 0:_.MULTI_SENSOR_1.toString())==(n==null?void 0:n.encryptedId.toString())&&(i=!0)}),i==!0)return d(!1),g(!1),x(!1),N(""),v({name:"",mac:"",encryptedId:""}),O.push(e.jsx(E,{title:"This service is already installed for this device.",type:"danger"}),{placement:"top-center"});const C=await Z({userId:o,serviceId:s==null?void 0:s._id,installedServiceName:s==null?void 0:s.serviceName,installedServiceImage:s==null?void 0:s.serviceImage,description:s==null?void 0:s.description,code:s==null?void 0:s.code,deviceMap:{MULTI_SENSOR_1:(n==null?void 0:n.encryptedId)||""}});z(!1),C!=null&&C.data.success?($("/installed"),O.push(e.jsx(E,{title:"Service installed successfully",type:"success"}),{placement:"top-center"})):O.push(e.jsx(E,{title:"There was an error while installing service",type:"success"}),{placement:"top-center"}),d(!1),g(!1),x(!1),N(""),v({name:"",mac:"",encryptedId:""})}catch(i){console.log("Error while installing service, error: ",i)}}return e.jsxs("div",{className:`max-w-xs ${f}`,children:[e.jsxs(b,{isOpen:S,onClose:()=>g(!1),children:[e.jsx("h3",{className:"mb-8",children:"Install Service"}),e.jsx("div",{className:"flex mb-4 items-center justify-center",children:e.jsx(T,{className:"w-[300px] h-[175px] rounded-xl",src:c&&c||"/img/others/img-1.jpg",alt:"card header"})}),e.jsxs("section",{className:"flex flex-col gap-2 items-center text-[1rem]",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Name:"})," ",j]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Type:"})," ",u]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Description:"})," ",r]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Installation Price:"})," ",a," ","FDS"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Execution Price:"})," ",a," ","FDS"]}),e.jsx("p",{children:e.jsx("strong",{children:"-------------------------------------"})}),e.jsxs("p",{className:"flex items-center",children:[e.jsx("strong",{children:"Devices: "}),"  ",m,"  ",e.jsx(h,{className:"flex items-center justify-center",variant:"solid",size:"xs",onClick:()=>{var t,i;(i=(t=y==null?void 0:y.current)==null?void 0:t.children[0])==null||i.click()},children:e.jsxs(M,{trigger:"click",onSelect:U,placement:"middle-start-top",activeKey:m,ref:y,children:[e.jsx(M.Item,{eventKey:"My Devices",children:"My Devices"}),e.jsx(M.Item,{eventKey:"Shared Devices",children:"Shared Devices"})]})})]}),e.jsxs("p",{className:"flex items-center",children:[e.jsx("strong",{children:"Device: "}),"  ",n.name&&`${n.name} ( ${n.mac} )`,!n.name&&e.jsx(h,{className:"flex items-center justify-center",variant:"solid",size:"xs",onClick:()=>d(!0),children:"Select"}),e.jsxs(b,{isOpen:L,onClose:()=>d(!1),children:[e.jsx("h3",{className:"mb-8",children:m}),m==="My Devices"&&w.length>0&&w.map((t,i)=>e.jsx(B,{data:t},i)),m==="My Devices"&&w.length==0&&e.jsx("h5",{className:"text-center",children:"You don't have any devices"}),m==="Shared Devices"&&I.length>0&&I.map((t,i)=>e.jsx(B,{data:t},i)),m==="Shared Devices"&&I.length==0&&e.jsx("h5",{className:"text-center",children:"No shared devices found !"})]})]}),e.jsx("p",{children:e.jsx("strong",{children:"-------------------------------------"})}),e.jsxs("div",{className:"w-full gap-4 mt-2 flex justify-center",children:[n.name&&e.jsx(h,{className:"",variant:"solid",color:"green",size:"sm",onClick:()=>x(!0),children:"Install Service"}),e.jsxs(b,{isOpen:A,onClose:()=>x(!1),contentClassName:"w-1/3 h-1/3",closable:!1,children:[e.jsx("h3",{className:"mb-8",children:"Install Confirm"}),e.jsx("h4",{className:"mb-6 text-center",children:"Are you sure about installing this service?"}),e.jsxs("div",{className:"flex justify-center w-2/5 justify-between mx-auto",children:[e.jsx(h,{className:"px-6",variant:"solid",color:"green",size:"sm",loading:F,onClick:Y,children:"Yes"}),e.jsx(h,{className:"px-6",variant:"solid",color:"red",size:"sm",onClick:()=>x(!1),children:"No"})]})]}),n.name&&e.jsx(h,{className:"",variant:"solid",color:"yellow",size:"sm",onClick:()=>d(!0),children:"Change Device"})]})]})]}),e.jsxs(R,{clickable:!0,className:"w-[300px] hover:shadow-lg transition duration-150 ease-in-out dark:border dark:border-gray-600 dark:border-solid",header:D,footer:K,headerClass:"p-0",footerBorder:!1,headerBorder:!1,children:[e.jsx("span",{className:"text-emerald-600 font-semibold",children:u}),e.jsx("h4",{className:"font-bold my-3",children:j}),e.jsx("div",{className:"h-16 line-clamp-4",style:{textOverflow:"ellipsis"},children:r})]})]})};function Je(){const[f,j]=l.useState(!0),[a,u]=l.useState([]);return l.useEffect(()=>{async function r(){var s;const c=await ee();u((s=c==null?void 0:c.data)==null?void 0:s.data),j(!1)}r()},[]),e.jsxs("div",{children:[e.jsx("h3",{className:"pb-4",children:"Service Market"}),e.jsx(se,{}),f===!1&&e.jsx("div",{className:"grid xl:grid-cols-3",children:a==null?void 0:a.map(r=>e.jsx(te,{className:"mt-8 mx-auto",name:r.serviceName,description:r.description,type:r.serviceType,installationPrice:r.installationPrice,serviceImage:r.serviceImage||"",serviceData:r},r._id))})||e.jsx("div",{className:"w-full h-[65vh] flex justify-center items-center",children:e.jsx(H,{loading:!0})}),f===!1&&a.length===0&&e.jsx("div",{className:"w-full h-[65vh] flex justify-center items-center",children:e.jsx("h1",{children:"Data not found !"})})]})}export{Je as default};
