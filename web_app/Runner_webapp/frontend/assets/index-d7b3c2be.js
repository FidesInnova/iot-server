import{q as R,aL as U,r as u,j as e,a9 as k,u as q}from"./index-bf8a941f.js";import"./Alert-1d842e79.js";import{A as B}from"./Tag-338a2893.js";import"./Badge-b1f0ab32.js";import{B as C}from"./Button-0f33c8fd.js";import"./index-6975cd84.js";import"./Card-24bc2910.js";import"./index-9cb1fb6e.js";import"./Skeleton-67f3ebea.js";import"./Switcher-2f2e5a73.js";import"./index-8128ce47.js";import{F as _}from"./FormContainer-7c6e47ec.js";import{I as b}from"./Input-9402e44f.js";import"./index-754123b4.js";import{t as v,N as g}from"./toast-c77230e6.js";import"./index-6728dd01.js";import{S as J,c as M}from"./Select-d53c46ac.js";import"./index-de79736a.js";import"./index-18669cea.js";import"./index-0a71f11b.js";import{U as $}from"./Upload-cf8abc1c.js";import{F as f}from"./FormRow-31162199.js";import{c as O,a as j,F as V,b as H,d as y}from"./index.esm-510ed08c.js";import{z as K,s as X}from"./index.esm-4fe97196.js";import{d as Z,e as Q,f as W}from"./ServiceAPI-25e2710b.js";import{a as E}from"./MediaAPI-e2a7ad99.js";import"./RichTextEditor-3ec4d100.js";import"./Views-4bab5f03.js";import"./SegmentItemOption-48394355.js";import"./SvgIcon-51ef36c9.js";import"./StatusIcon-0225b6e9.js";import"./CloseButton-d50c43fd.js";import"./motion-23928477.js";import"./usePopper-113fdeb0.js";import"./index-a2b882c4.js";import"./index-2e58d6d9.js";import"./context-3c7bf7d8.js";import"./useControllableState-1a7323ea.js";import"./cloneDeep-93156ba4.js";import"./_MapCache-72043566.js";import"./get-9e555ae1.js";import"./index-13a8329a.js";import"./index-346a9733.js";import"./useThemeClass-81aec1c2.js";const P=[{value:"automation",label:"Automation"}],{Control:Y}=M,ee=({children:p,...l})=>(l.getValue()[0],e.jsx(Y,{...l,children:p})),re=O().shape({serviceName:j().required(),serviceType:j().required(),description:j().required(),serviceImage:j()}),te=({innerProps:p,label:l,isSelected:d})=>e.jsxs("div",{className:`flex items-center justify-between p-2 ${d?"bg-gray-100 dark:bg-gray-500":"hover:bg-gray-50 dark:hover:bg-gray-600"}`,...p,children:[e.jsx("div",{className:"flex items-center",children:e.jsx("span",{className:"ml-2 rtl:mr-2",children:l})}),d&&e.jsx(X,{className:"text-emerald-500 text-xl"})]}),ae=({userId:p=q(l=>l.auth.user)})=>{const l=R(),{serviceId:d}=U(),[S,T]=u.useState(!1),[A,w]=u.useState(!1),[x,D]=u.useState(),[N,I]=u.useState(""),[G,F]=u.useState({userId:p._id,serviceName:"",serviceType:"",description:"",serviceImage:""});u.useEffect(()=>{const c=async()=>{var t;try{const n=await Z(d||""),r=(t=n==null?void 0:n.data)==null?void 0:t.data;if(r.userId!=p._id)return l("/services");if(r)F(m=>({...m,serviceName:r.serviceName,serviceType:r.serviceType,description:r.description,serviceImage:r.serviceImage||""})),r.serviceImage&&I(r.serviceImage),w(!0);else return l("/services")}catch(n){w(!0),console.error("Error fetching data:",n)}};d=="new"?(T(!0),F({userId:p._id,serviceName:"",serviceType:"",description:"",serviceImage:""}),w(!0)):c()},[d]);const L=(c,t)=>{if(S){async function n(){var r,m;try{const a=new FormData;a.append("file",x);const s=x?await E("profile",a):"";await Q({...c,serviceImage:((m=(r=s==null?void 0:s.data)==null?void 0:r.data)==null?void 0:m.url)||""})&&(v.push(e.jsx(g,{title:"Service Created",type:"success"}),{placement:"top-center"}),t(!1),l("/services"),setTimeout(()=>{},500))}catch(a){t(!1),v.push(e.jsx(g,{title:a.message,type:"danger"}),{placement:"top-center"})}}n()}else{async function n(){var r,m,a,s;try{const i=new FormData;i.append("file",x);const o=x?await E("profile",i):"",h=await W({...c,serviceId:d,serviceImage:((m=(r=o==null?void 0:o.data)==null?void 0:r.data)==null?void 0:m.url)||""});t(!1),((s=(a=h==null?void 0:h.data)==null?void 0:a.data)==null?void 0:s.success)===!1?v.push(e.jsx(g,{title:"Error while editing service",type:"danger"}),{placement:"top-center"}):(v.push(e.jsx(g,{title:"Service Edited",type:"success"}),{placement:"top-center"}),l("/services"))}catch(i){v.push(e.jsx(g,{title:i.message,type:"danger"}),{placement:"top-center"}),t(!1)}}n()}},z=c=>{const t=c.target.files[0];if(t&&(t.type==="image/png"||t.type==="image/jpeg"||t.type==="image/jpg")){if(t.size>512e3){alert("Please upload a file smaller than 500KB.");return}const r=new FileReader;r.onload=m=>{var a;if((a=m.target)!=null&&a.result){const s=m.target.result,i=new Image;i.src=s,i.onload=()=>{const o=i.width,h=i.height;o<=300&&h<=175?(D(t),I(s)):alert("Please upload a valid image file with dimensions 300 x 175 pixels.")}}},r.readAsDataURL(t)}else alert("Please upload a valid ( PNG, JPEG, JPG ) file.")};return e.jsx(e.Fragment,{children:A&&e.jsxs("main",{className:"w-100 h-full flex flex-col",children:[S&&e.jsx("h1",{children:"Create Service"})||e.jsx("h1",{children:"Edit Service"}),e.jsx(V,{enableReinitialize:!0,initialValues:G,validationSchema:re,onSubmit:(c,{setSubmitting:t})=>{t(!0),setTimeout(()=>{L(c,t)},1e3)},children:({values:c,touched:t,errors:n,isSubmitting:r,resetForm:m})=>{const a={touched:t,errors:n};return e.jsx(H,{children:e.jsxs(_,{children:[e.jsx(f,{name:"serviceName",label:"Service Name :",...a,children:e.jsx(y,{type:"text",autoComplete:"off",name:"serviceName",placeholder:"service name...",component:b})}),e.jsx(f,{name:"serviceType",label:"Service Type :",...a,children:e.jsx(y,{name:"serviceType",children:({field:s,form:i})=>e.jsx(J,{field:s,placeholder:"Select Service Type",form:i,options:P,components:{Option:te,Control:ee},value:P.filter(o=>o.value===(c==null?void 0:c.serviceType)),onChange:o=>i.setFieldValue(s.name,o==null?void 0:o.value)})})}),e.jsx(f,{name:"description",label:"Service Description :",...a,children:e.jsx(y,{textArea:!0,type:"text",autoComplete:"off",name:"description",placeholder:"service description...",component:b})}),e.jsx(f,{name:"serviceImage",label:"Service Image :",...a,children:e.jsxs("div",{className:`flex w-full items-center ${N&&"justify-around"||"gap-10"}`,children:[e.jsx(y,{name:"serviceImage",children:({field:s,form:i})=>{const o=s.value?{src:s.value}:{};return e.jsx($,{className:"cursor-pointer",showList:!1,uploadLimit:1,accept:".png, .jpg, .jpeg",onChange:z,children:!N&&e.jsx(B,{className:"border-2 border-white dark:border-gray-800 shadow-lg",size:60,shape:"circle",icon:e.jsx(K,{}),...o})||e.jsx("img",{src:N,alt:"Uploaded Service Image",style:{width:"300px",height:"175px"}})})}}),e.jsxs("p",{children:[e.jsx("strong",{children:"Image Upload Requirements:"}),e.jsx("br",{}),e.jsx("strong",{children:"Format:"})," ","PNG, JPEG, JPG ",e.jsx("br",{}),e.jsx("strong",{children:"Size:"})," ","300x175 pixels Maximum",e.jsx("br",{}),e.jsx("strong",{children:"File size:"})," ","500 KB"]})]})}),e.jsx("div",{className:"mt-4 ltr:text-right",children:S&&e.jsx(C,{variant:"solid",loading:r,type:"submit",children:r?"Creating":"Create"})||e.jsx(C,{variant:"solid",loading:r,type:"submit",children:r?"Editing":"Edit"})})]})})}})]})||e.jsx("main",{className:"w-100 h-full flex flex-col",children:e.jsx(k,{loading:!0})})})},Ke=ae;export{Ke as default};
